name: wanaid

services:
  website-dev:
    build:
      context: ../../
      dockerfile: docker/website-nextjs/Dockerfile.dev
      args:
        - PORT=${PORT:-9331}
    container_name: wanaid-website
    ports:
      - "${PORT:-9331}:${PORT:-9331}"
    env_file:
      - ../../frontend/website/nextjs/.env.local
      # Same API key as backend (single source of truth for server-side x-api-key)
      - ../../backend/cms-api/.env
    environment:
      - NODE_ENV=development
      - PORT=${PORT:-9331}
      # Client (browser) talks to backend on host
      - NEXT_PUBLIC_API_URL=http://localhost:${CMS_API_PORT:-9332}/api
      # Server-side fetch from container must use host (Docker Mac/Windows)
      - CMS_API_URL=http://host.docker.internal:${CMS_API_PORT:-9332}/api
      - NEXT_PUBLIC_SITE_URL=http://localhost:${PORT:-9331}
      - TRANSLATIONS_URL=http://localhost:${CMS_API_PORT:-9332}
    volumes:
      - ../../frontend/website/nextjs/app:/app/app
      - ../../frontend/website/nextjs/components:/app/components
      - ../../frontend/website/nextjs/context:/app/context
      - ../../frontend/website/nextjs/hooks:/app/hooks
      - ../../frontend/website/nextjs/lib:/app/lib
      - ../../frontend/website/nextjs/i18n:/app/i18n
      - ../../frontend/website/nextjs/messages:/app/messages
      - ../../frontend/website/nextjs/public:/app/public
      - ../../frontend/website/nextjs/.env.local:/app/.env.local:ro
      - ../../frontend/website/nextjs/tailwind.config.ts:/app/tailwind.config.ts:ro
    restart: unless-stopped
